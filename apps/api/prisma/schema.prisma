generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          String       @id @default(cuid())
  name        String
  email       String?
  userTagId   String       @unique
  role        String       @default("USER")
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @default(now()) @updatedAt
  assignments Assignment[]
  assetsHeld  Asset[]
}

model Category {
  id        String  @id @default(cuid())
  name      String  @unique
  assetsRel Asset[] @relation("AssetCategory")
}

model Location {
  id        String  @id @default(cuid())
  name      String  @unique
  assetsRel Asset[] @relation("AssetLocation")
}

model Asset {
  id          String       @id @default(cuid())
  name        String
  assetTagId  String       @unique
  category    String?
  holderUserId String?
  holderUser  User?        @relation(fields: [holderUserId], references: [id])
  serial      String?
  airtagId    String?
  status      String       @default("AVAILABLE")
  categoryId  String?
  locationId  String?
  deletedAt   DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  categoryRel Category?    @relation("AssetCategory", fields: [categoryId], references: [id])
  locationRel Location?    @relation("AssetLocation", fields: [locationId], references: [id])
  assignments Assignment[]

  @@index([status])
  @@index([categoryId])
  @@index([locationId])
  @@index([deletedAt])
}

model Assignment {
  id           String    @id @default(cuid())
  assetId      String
  userId       String
  checkedOutAt DateTime  @default(now())
  dueAt        DateTime?
  returnedAt   DateTime?
  asset        Asset     @relation(fields: [assetId], references: [id])
  user         User      @relation(fields: [userId], references: [id])

  @@index([assetId, returnedAt])
  @@index([userId, returnedAt])
  @@index([dueAt])
}

model Event {
  id        String   @id @default(cuid())
  ts        DateTime @default(now())
  type      String
  assetTagId String?
  userTagId String?
  confidence Float?
  details   Json?
  createdAt DateTime @default(now())

  @@index([type])
  @@index([assetTagId])
  @@index([userTagId])
  @@index([createdAt])
}

model Observation {
  id        String   @id @default(cuid())
  ts        DateTime
  gatewayId String
  zone      String
  tagId     String
  tagType   String
  rssi      Int
  createdAt DateTime @default(now())
}
